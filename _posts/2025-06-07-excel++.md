---
title: Excel clone pjt
date: 2025-06-07 19:34:00 +0900
categories: 
tags: 
pin: false
mermaid: "false"
image: 
incomplete: true
math: true
published: true
comments: true
---
``## 구현리스트
흔히들 게임에서 구현하는 심리스 월드를 구현하려고 한다. 이런 개념을 도입하면 virtualization과 lazy-loading을 동시에 구현할 수 있을 것이다.

![마인크래프트 청크](minecraft_chunk.png)

- [ ] Chunk 개념을 도입한다.
	- [ ] 필요하다면 Chunk size를 수정할 수 있게 만든다.
	- [ ] 표의 크기가 충분히 크지 않다면 가상화만 사용한다.
- [ ] Zoom in / out 기능 구현하기
- [ ] 셀 관련 
	- [ ] 폰트 스타일 관련
	- [ ] 정렬 및 배치 관련
	- [ ] 특수 키 조합(`ctrl`, `shift`, `alt`)
		- [ ] 클릭/드래그 관련
			- [ ] `ctrl` 누를 시 추가 range를 설정한다 (`Union`)
				- [ ] 이 때 기준 셀의 위치를 변경한다.
			- [ ] `shift` 누를 시 기준 셀로부터 array로 범위를 설정한다.
		- [ ] 그 외 특수 키를 입력하지 않고 단순 문자열, 0~9, 특수문자 입력 시 입력모드로 진입
			- [ ] 입력할 때 `Alt` 키와 `enter` 키를 조합하여 다음 줄로 넘어가되, 텍스트 양식의 경우 기본 enter키가 줄 바꿈으로 동작할 것.
	- [ ] 드래그 관련
		- [ ] 기준 셀과 범위를 지정하게 만든다.
		- [ ] 구역을 정했으면 그 범위에만 `tab`, `enter`로 이동할 수 있게 만든다.(Arrow 키 누르는 즉시 범위 해제)
	- [ ] 키 입력 관련
		- [ ] 
	- [ ] **equation** 기능 지원
		- [ ] `Error` 기능
		- [ ] `warning` 기능
		- [ ] 순환참조 기능
- [ ] 뷰 관련
	- [ ] 다중 분할 셀 고정 기능을 구현한다. 
		- [ ] 특히 문서화할 때, 특정 칼럼이나 행만 살려서 문서에 맞는 형식으로 끼워주기.
	- [ ] 그룹 기능을 적극적으로 활용한다.
- [ ] `store.js`
	- [ ] 근본적으로 **store를 json 형태**로 수정할 필요가 있다.
	- [ ] 늘 로컬 python과 js로 실행할 수 있게 만들어야 한다.

여기서 가상화와  LazyLoading 방식이 좀 헷갈린다...

#### 가상화
```js
// 전체 데이터는 메모리에 있지만 DOM은 제한
const allData = new Map() // 100만개 데이터 (메모리에 상주)
const visibleCells = []   // 200개만 DOM 생성

// 스크롤시 DOM 재사용
function onScroll() {
  const newRange = calculateVisibleRange()
  // 기존 DOM 요소 내용만 교체
  updateCellContents(newRange)
}
```


#### Lazy Loading
```js
// 데이터 자체를 필요할 때만 로드
const loadedData = new Map() // 처음엔 비어있음

async function getCellData(row, col) {
  const key = `${row},${col}`
  
  if (!loadedData.has(key)) {
    // 처음 접근시에만 데이터 로드
    const data = await fetchCellData(row, col)
    loadedData.set(key, data)
  }
  
  return loadedData.get(key)
}
```


```javascript
let activeCell : Cell | cell | null = $state(null)

function selectCell(row : number, col : number) {
	activeCell = { row, col }
	selectedCell.set({ row, col })
}

<Cell
	{row} {col}
	value={$cells[`${row},${col}`] || ''}
	style={$cellStyles[`${row},${col}`] || {}}
	isSelected={activeCell?.row === row && activeCell?.col === col}
	formula = {evaluateFormula}
	on:select={() => selectCell(row, col)}
	on:change={(event)=>store.updateCell(row, col,event.detail)}
/>  
```
