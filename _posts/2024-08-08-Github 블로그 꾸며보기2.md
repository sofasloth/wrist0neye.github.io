---
title: Github 블로그 꾸며보기2 (+obisidan)
date: 2024-08-08 00:53:00 +0900
categories:
  - Doodle
  - Diary
permalink: 
tags:
  - diary
  - blog
comments: true
published: true
math: true
image: 
linkpreview: false
---
github 블로그는 나 같은 초보자한테 초기세팅부터 어려웠다. 다행히 *Chirpy* 블로그가 디자인이 깔끔하면서 초기세팅이 편한 편이었다. 그럼에도 Tistory나 velog에 비해 손이 많이 가는데, 내가 옵시디언을 정말 자주 사용하기 때문에 오히려 좋은 점도 많다.

예를 들어, 내가 이전에 작성한 블로그를 참고하고 싶으면 옵시디언으로 켜서 편집을 하면 된다. 이미지 그대로 사용하고 싶으면 드래그 앤 드롭으로 옮겨주면 알아서 참조해준다.

#### 아래 relative-link 구현하는 용도로 만든 dummy header 입니다. 특수문자 1!2@3#4$5%6^7&8*9.0,a;b c<>d+e{}f-g_ 어떻게 보일까요? 
![](assets/img/res/Pasted%20image%2020240808010433.png) ^9f4625

그리고 나는 local graph view 말고 graph view 자체는 잘 안 쓰는데 가끔 한 번씩 키면 괜시리 열심히 작성했다는 느낌을 받는다.

![Pasted image 20240808010356](assets/img/res/Pasted%20image%2020240808010356.png)
또, 이미지 파일, `.gif` 같은 첨부파일 관리가 편하다. 파일 위치가 변경되어도 옵시디언에서 알아서 파일 위치를 업데이트 해준다.

그 대신 옵시디언을 사용하기 전에 몇 가지 세팅을 해줘야 한다.
## 1. File & links

![](assets/img/res/Pasted%20image%2020240808011033.png)

- Default location for new notes에서 `In the folder specified below`를 체크하고  `_posts`로 경로 지정
- New link format은 `Shortest..`로 설정해야 나중에 `relative link` 기능을 사용할 수 있다.
	- 수정하기 전에 `Absolute`로 표기했는데 이렇게 하면 노트 간 link 걸기가 어렵다.
- `[[Wikilinks]]` 사용을 해제한다. 
	- 옵시디언의 경우 `![[파일이름]]` 으로 파일을 임베드 혹은 참조를 하는데 이 기능은 옵시디언에서만 지원한다.
	- 이 기능을 키면 띄워쓰기도 `%20`으로 치환되서 확실하게 참조해주기 때문에 꼭 켜주자.
	- 보통의 마크다운처럼 `![]()`으로만 참조한다.
- Detect all file extensions 필수는 아니지만 스크립트 파일을 사용한다면 이걸 체크해야 보인다.
	- 대신, file 탐색 결과가 지저분해진다는 단점이 있다.
- Default location for new attachements는 사진, gif 파일 같은 첨부파일을 어디로 저장할지 설정하는 값이다. 이 부분은 취향이니 편한대로 세팅하자.

## 2. Template 및 노트 기본값 설정
- 우선, template 파일을 만들자.
- 이 부분이 옵시디언 + github 불편한 점 중 하나인데, 옵시디언이 최근 **metadata(properties)** 를 페이지처럼 만들어서 자꾸 형식이 깨진다.
- 문서 metadata 설정할 때만큼은 반드시 **live preview** 모드를 끄고 **source mode**로 바꿔주자.

![](assets/img/res/Pasted%20image%2020240808012221.png)

> *Chirpy* 블로그의 경우 특히, `image` 설정 부분이 아래 사진처럼 해야 하는데 최신 버전의 옵시디언은 `path: ...` 형식을 잘 인식하지 못한다. 그렇기 때문에 이 부분은 어쩔 수 없이 source mode로 작성해줘야 한다.
{: .prompt-warning }

![](assets/img/res/Pasted%20image%2020240808012409.png)

그러고 나서 **Daily note**와 **Unique note creator** 중 사용하는 기능에 대해서 위에서 만든 *template*파일을 template으로 설정해주면 파일생성할 때 대부분의 metadata는 자동으로 완성시켜줄 것이다.

![](assets/img/res/Pasted%20image%2020240808012836.png)

## 3. 스크립트 파일 만들기
이거는 mac/리눅스면 bash, 윈도우면 batch파일을 만들어서 해도 되고 아니면 `os.system()`으로 도배된 `.py`로도 충분히 구현할 수 있는 기능이다. 다만, 파이썬의 경우 아나콘다같은 프로그램을 깔았으면 환경변수가 바뀌어서 파이썬 스크립트 실행이 안 될 때도 있다. 그럴 땐 다시 `.py`를 직접 실행하는 bash/batch 파일을 만들어도 된다.

 아무튼 일단 있으면 편한 `jekyll` 빌드 스크립트 파일만 만들고 필요하면 추가해서 쓰면 된다.
 1. `jekyll` localhost 빌드
 2. 수동 git-add-commit-push 자동 스크립트

### 1. jekyll localhost 빌드
실행하는 스크립트 위치를 잘 고려해서 다음 코드를 작성한다. `ruby` 환경변수 설정이 되어 있다면 win/mac/linux 사용가능 한 코드다.
```shell
bundle exec jekyll serve --trace
```

### 2. git add-commit-push 자동화
- git 써드파티 플러그인을 깔았으면 자동으로 백업 타이머를 맞추면 된다.
- 근데 블로그 빌드 실패해서 바로 수동으로 push 하고 싶을 때 아래 스크립트를 실행한다.

```batch
@echo off
set "currentDate=%date%"
set "currentTime=%time%"

for /f "tokens=1-4 delims=/- " %%a in ("%currentDate%") do (
    set "year=%%a"
    set "month=00%%b"
    set "day=00%%c"
)

set month=%month:~-2%
set day=%day:~-2%
set "formattedDate=%year%-%month%-%day%"

for /f "tokens=1-3 delims=:., " %%a in ("%currentTime%") do (
    set "hour=00%%a"
    set "minute=00%%b"
    set "second=00%%c"
)

set hour=%hour:~-2%
set minute=%minute:~-2%
set second=%second:~-2%
set "formattedTime=%hour%:%minute%:%second%"

:: commit 메시지 확인용
echo "[Comment]blog update at %formattedDate% T %formattedTime%"

@echo on
pause


git add -A
git commit -m "blog update at %formattedDate% T %formattedTime%"

pause

git push origin main
pause
```
<br><br>
## 4. ruby plugin 설치하기
### [1. jekyll-relative-links](https://github.com/benbalter/jekyll-relative-links)
markdown `[다른 파일](다른 파일.md)` 링크를 걸고 싶으면  위 링크의 플러그인을 설치해야 한다.
```ruby
gem install jekyll-relative-links
```

성공적으로 설치가 되었다면 `[이전 글](2024-08-04-Github.io블로그%20꾸며보기.md)`을 참조해야 하는데.. 잘 안된다.
이 플러그인은 현재 주소 뒤에  `/`을 붙이고 추가로 주소를 늘리는 방식을 택하고 있는데, 이렇게 하면 엉뚱한 주소를 참조하게 된다.

![](/assets/img/res/Pasted%20image%2020240811042940.png)


일단 obsidian의 규칙을 좀 더 파악해보자. 참고로 아래 링크는 옵시디언에서는 작동이 안 되는데 블로그에서는 정상적으로 작동된다.
```md
[아래 relative-link 구현하는 용도로 만든 dummy header 입니다. 특수문자 1!2@3#4$5%6^7&8*9.0,a;b c<>d e{} 어떻게 보일까요?](#아래%20relative-link%20구현하는%20용도로%20만든%20dummy%20header%20입니다.%20특수문자%201!2@3%204$5%6%207&8*9.0,a;b%20c<>d%20e{}%20어떻게%20보일까요?)
```

- 같은 문서 내 heading 참조 : `[1. File & links](#1.%20File%20&%20links)`
- 다른 문서 참조 : `[2024-08-04-Github.io블로그 꾸며보기](2024-08-04-Github.io블로그%20꾸며보기.md)`
- 다른 문서 내 heading 참조 : `[댓글 기능 구현하기](2024-08-04-Github.io블로그%20꾸며보기.md#댓글%20기능%20구현하기)`

`()` 안의 문자열을 어떻게 수정할지만 생각해보자.
- 다른 문서를 참조할 때
	- 날짜형식 `yyyy-mm-dd-`은 제거한다.
	- `.md` 문자열은 제거한다.
	- `baseurl`인 `https://{id}.github.io/`, `localhost:4000/` 뒤 쪽에 주소를 붙여넣을 것.
- 다른 heading을 참조할 때(다른 문서도 포함)
	- `#` 문자가 포함되어 있을 경우 `/#`을 현재주소 뒤에 붙인다.
		- 이미 다른 heading을 참조 중일 때는 `/#` 이전까지만 가져와서 주소를 이어붙인다.
	- `#` 뒤에 오는 `%20` (띄어쓰기) 문자는 전부 `-`로 치환한다.
	- `!@#$%^&*()[]{},.{}()[]?+_`등의 특수문자들은 그냥 제거한다.
		- `-`는 `-`로 표기된다.
		- obsidian의 경우 일부 문자열을 사용하지 않는다. 
		- 이 때의 `#`는 Heading이 아니라 특수문자로 취급한다.

Ruby는 다뤄보지 않아서 위 규칙에 맞는 코드를 작성해달라고 chatGPT에게 도움을 요청했다.  

- path : `/_plugins/obsidian_link_converter.rb`
- `_config.yml` 파일에 `plugin` 항목에 추가할 것.

```ruby
module Jekyll
  class ObsidianLinkConverter < Converter
    safe true
    priority :low

    def matches(ext)
      ext =~ /^\.md$/i
    end

    def output_ext(ext)
      ".html"
    end

    def convert(content)
      content = convert_links(content)
      content
    end

    private

    def convert_links(content)
      # 패턴을 찾아서 링크를 변환
      content.gsub(/\[([^\]]+)\]\(([^)]+)\)/) do
        link_text = $1
        link_url = $2

        if link_url.include?("#")
          # 헤딩을 참조하는 경우
          link_url = convert_heading_link(link_url)
        else
          # 일반 문서 링크인 경우
          link_url = convert_document_link(link_url)
        end

        "[#{link_text}](#{link_url})"
      end
    end

    def convert_document_link(link_url)
      # yyyy-mm-dd- 형식을 제거
      link_url = link_url.gsub(/\d{4}-\d{2}-\d{2}-/, '')
      # .md 확장자를 제거
      link_url = link_url.gsub(/\.md$/, '')
      # baseurl 앞에 붙이기
      link_url = "{{ site.baseurl }}/#{link_url}"
      link_url
    end

    def convert_heading_link(link_url)
      # 문서 링크와 헤딩 부분을 분리
      document_part, heading_part = link_url.split("#", 2)

      # 문서 링크 부분을 처리
      document_part = convert_document_link(document_part) unless document_part.empty?

      # heading 부분을 변환
      heading_part = convert_heading(heading_part) if heading_part
      # 링크를 결합
      "#{document_part}##{heading_part}"
    end

    def convert_heading(heading)
      # %20을 -로 변환
      heading = heading.gsub("%20", "-")
      # 특수문자 제거
      heading = heading.gsub(/[^a-zA-Z0-9\-]/, '')
      heading
    end
  end
end
```

그럼에도 불구하고 여전히 동작하지 않는다. 결국 직접 만들어야 하는 상황이 왔는데 이 때 [regex simulator for ruby](https://rubular.com/)랑 [ruby의 sub, gsub](https://jsikim1.tistory.com/291) 설명 글을 참고하면 좋다.

<% linkpreview "https://rubular.com/" %>

<% linkpreview "https://jsikim1.tistory.com/291" %>



> 여전히 해결이 안 되는 부분들
> - obsidian의 `[[^]]`으로 `image`, `paragraph` 등 컴포넌트 단위로 참조하는 기능을 구현하기 어려워서 여기서는 다루지 않는다.
> - 옵시디언의 경우 제목에 오는 # 문자는 `%20`으로 치환되는데 이건 따로 구분할 방법이 없다. 최대한 Heading에 `#` 외에도 `^, [], |`  등의 특수 문자를 섞어쓰지 않도록 주의한다.
> 	- ![](/assets/img/res/Pasted%20image%2020240811043914.png)
> 	- ![[Pasted image 20240811120604.png]]
{: .prompt-danger }

<br>
### [2. linkpreview](https://github.com/ysk24ok/jekyll-linkpreview)
```ruby
gem install jekyll-gist jekyll-coffeescript jekyll-remote-theme some-other-jekyll-plugin jekyll-linkpreview
```

그리고 `/assets/css` 폴더 내에 `linkpreview.css` 파일을 생성한다. 내용은 [여기 페이지 코드](https://github.com/ysk24ok/jekyll-linkpreview/blob/master/assets/css/linkpreview.css)대로 채우면 된다.

`[2024-08-04-Github.io블로그 꾸며보기](_posts/2024-08-04-Github.io블로그%20꾸며보기.md)`에서 rich link 구현을 실패했었는데, 위 플러그인을 설치하고 아래와 같은 문법으로 작성하면 livepreview 링크를 만들 수 있다. 

{% raw %}
```liquid
{% linkpreview "url" %}
```
{% endraw %}

Linkpreview의 기본 css 스타일과 Chirpy 스타일과 조금 잘 안 어울린다. 그에 맞게 약간의 수정이 필요하다. 개발자 도구를 열어보면 `_layouts/home.html`를 열어보면 이 테마의 preview는 `bootstrap`의 `card`인 걸 확인할 수 있다. 

그리고 `.row` 코드와 같이 특정 폭 크기에 따라 형태가 바뀌는 `@media`도 적용되어 있다. `home.html`의 일부 코드는 아래와 같다.
{% raw %}
```html
<!--home.html-->
<div id="post-list" class="flex-grow-1 px-xl-1">
  {% for post in posts %}
    <article class="card-wrapper card">
      <a href="{{ post.url | relative_url }}" class="post-preview row g-0 flex-md-row-reverse">
        {% assign card_body_col = '12' %}
        
        {% if post.image %}
          {% assign src = post.image.path | default: post.image %}
          {% unless src contains '//' %}
            {% assign src = post.media_subpath | append: '/' | append: src | replace: '//', '/' %}
          {% endunless %}
  
          {% assign alt = post.image.alt | xml_escape | default: 'Preview Image' %}
  
          {% assign lqip = null %}
  
          {% if post.image.lqip %}
            {% capture lqip %}lqip="{{ post.image.lqip }}"{% endcapture %}
          {% endif %}
  
          <div class="col-md-5">
            <img src="{{ src }}" alt="{{ alt }}" {{ lqip }}>
          </div>
  
          {% assign card_body_col = '7' %}
        {% endif %}
  
        <div class="col-md-{{ card_body_col }}">
          <div class="card-body d-flex flex-column">
            <h1 class="card-title my-2 mt-md-0">{{ post.title }}</h1>
  
            <div class="card-text content mt-0 mb-3">
              <p>{% include post-description.html %}</p>
            </div>
  
            <div class="post-meta flex-grow-1 d-flex align-items-end">
              <div class="me-auto">
                <!-- posted date -->
                <i class="far fa-calendar fa-fw me-1"></i>
                {% include datetime.html date=post.date lang=lang %}
  
                <!-- categories -->
                {% if post.categories.size > 0 %}
                  <i class="far fa-folder-open fa-fw me-1"></i>
                  <span class="categories">
                    {% for category in post.categories %}
                      {{ category }}
                      {%- unless forloop.last -%},{%- endunless -%}
                    {% endfor %}
                  </span>
                {% endif %}
              </div>
  
              {% if post.pin %}
                <div class="pin ms-1">
                  <i class="fas fa-thumbtack fa-fw"></i>
                  <span>{{ site.data.locales[lang].post.pin_prompt }}</span>
                </div>
              {% endif %}
            </div>
            <!-- .post-meta -->
          </div>
          <!-- .card-body -->
        </div>
      </a>
    </article>
  {% endfor %}
</div>
<!-- #post-list -->
```
{% endraw %}


![bootstrap_card](assets/img/res/bootstrap_card.gif)

그리고 아래 사진과 같이 `naver`, `google` 같이 *Open Graph protocol metadata* (줄여서 `og`) 가 없는 경우도 있으니 이 때 사용하는 `linkpreview_nog.html`도 별도로 만들어두자.

> `linkpreview_nog.html` 없을 경우 나오는 화면
>![linkpreview_nog.html을 만들어두지 않은 경우](/assets/img/res/Pasted%20image%2020240811032023.png)
{: .prompt-warning }

![](assets/img/res/Pasted%20image%2020240811114936.png)

#### 1. linkpreview.html 
- path : `/_includes/linkpreview.html`
- 이상하게도 `<a>` 태그 안에 `<div>` 태그들을 집어넣을 수 없어 위의 `home.html` 처럼 짜기가 어려웠다.
	- [여기 블로그 글](https://velog.io/@jongk91/%EA%B0%84%EB%8B%A8-a%ED%83%9C%EA%B7%B8-%EC%A0%84%EC%B2%B4%EC%A0%81%EC%9A%A9)을 참고하여 `<a>` 태그가 `div.card` 전체를 차지하도록 만드는 방식으로 구현했다.

{% raw %}

```html
<!--linkpreview.html-->
<link rel="stylesheet" type = "text/css" href="/assets/css/linkpreview.css" media="screen">
  
<div class="card bg-transparent jekyll-linkpreview-wrapper">
  <a href="{{url}}" class="post-preview jekyll-linkpreview-linkbox"></a>
    <div class ="post-preview row g-0 flex-md-row-reverse jekyll-linkpreview-inner">
        {% assign card_body_col = '12' %}
  
        {% if image %}
          {% assign src = image.path | default: image %}
          {% unless src contains '//' %}
            {% assign src = post.media_subpath | append: '/' | append: src | replace: '//', '/' %}
          {% endunless %}
  
          {% assign alt = image.alt | xml_escape | default: 'Preview Image' %}
  
          {% assign lqip = null %}
  
          {% if image.lqip %}
            {% capture lqip %}lqip="{{ image.lqip }}"{% endcapture %}
          {% endif %}
  
          <div class="col-md-5">
            <div class="preview-img jekyll-linkpreview-img-wrapper">
              <img src="{{src}}" alt="{{alt}}" {{lqip}}>
            </div>
          </div>
  
          {% assign card_body_col = '7' %}
        {% endif %}
  
        <div class="col-md-7">
            <div class="card-body d-flex flex-column">
                <h1 class="card-title my-2 mt-md-0 jekyll-linkpreview-title">{{ title }}</h1>
                <div class="card-text mt-0">
                    <p class = "jekyll-linkpreview-description">{{ description }}</p>
                </div>
                <span class="jekyll-linkpreview-domain">
                  {{ domain }}
                </span>
            </div>
        </div>
    </div>
</div>
```
{% endraw %}
#### 2. linkpreview_nog.html
- path : `/_includes/linkpreview_nog.html`

```html
<link rel="stylesheet" type = "text/css" href="/assets/css/linkpreview.css" media="screen">

<div class="card bg-transparent jekyll-linkpreview-wrapper">
  <a href="{{url}}" class="post-preview jekyll-linkpreview-linkbox"></a>
    <div class ="post-preview row g-0 flex-md-row-reverse jekyll-linkpreview-inner">
        <div class="col-md-12">
            <div class="card-body d-flex flex-column">
                <h1 class="card-title my-2 mt-md-0 jekyll-linkpreview-title">{{ title }}</h1>
                <div class="card-text mt-0">
                    <p class = "jekyll-linkpreview-description">{{ description }}</p>
                </div>
                <span class="jekyll-linkpreview-domain">
                  {{ domain }}
                </span>
            </div>
        </div>
    </div>
</div>
```

#### 3. linkpreview.css 
- path : `/assets/css/linkpreview.css`
- `card`, `post-preview` 같은 class는 *Chirpy* 블로그에 내장되어 있는 css를 재활용한 것이다.

```css
.jekyll-linkpreview-wrapper{
  margin-bottom:1.2rem;
}
  
.jekyll-linkpreview-inner {
  cursor: pointer;
}
  
.jekyll-linkpreview-linkbox{
  position: absolute;
  width: 100%;
  height: 100%;
  z-index:2;
  border:none !important;
  border-radius: 0.375rem;
  background-color: transparent;
}
  
.jekyll-linkpreview-img-wrapper{
  height:100%;
  display:flex;
  flex-direction: column;
  justify-content: center;
  padding-right:0;
}
  
.jekyll-linkpreview-title{
  font-size:1.25rem;
  font-weight: 400;
  color: var(--heading-color);
}
  
.jekyll-linkpreview-description{
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 3;
  overflow: hidden;
  color:var(--text-color);
  
  margin: 0;
}
  
.jekyll-linkpreview-domain{
  color:var(--text-muted-color);
  text-decoration: underline;
  text-underline-offset: 0.2rem;
}
```


#### linkpreview 결과물
아직 그림파일 크기 조절이 내맘대로 안 되서 아쉬운데 추후에 시간되면 추가 보완해볼 예정이다.

{% linkpreview "https://github.com/ysk24ok/jekyll-linkpreview" %}

{% linkpreview "https://www.google.com" %}

{% linkpreview "https://www.naver.com" %}

{% linkpreview "https://www.github.com" %}

#### `a tag is missing a reference` Failure 해결방안
`2024-08-11` localhost에서는 빌드가 되지만 github Action에서는 빌드가 안되는 문제가 발생했다. 이는 local에서는 `bundle exec jekyll serve`로 빌드하지만 Action에서는 `htmlproofer`를 동작시키는데 여기서 `a tag is missing a reference`라는 문제가 발생한다.
![](/assets/img/res/Pasted%20image%2020240811163621.png)

![](/assets/img/res/Pasted%20image%2020240811170723.png)
예를 들어, `404.html` 파일에 보면  `<a href =""` 과 같이 비어있는 코드를 보면 failure를 띄운다. 
그렇기 때문에 아래와 같이 코드를 수정해 `url`이  비어 있는 경우 `"\"`로 빌드할 수 있게 만든다.

{% raw %}
```html
<!--linkpreview.html-->
<!--linkpreview_nog.html-->
{% if page.linkpreview %}
<link rel="stylesheet" type = "text/css" href="/assets/css/linkpreview.css" media="screen">
  
<div class="card bg-transparent jekyll-linkpreview-wrapper">
  {% assign og_url = "/" %}
  {% if url and url != ""%}
    {% assign og_url = url%}
  {% endif %}
  <a href="{{og_url}}" class="post-preview jekyll-linkpreview-linkbox"></a>
    <!-- 생략 -->
<!--마지막 부분에 코드 추가-->
{% endif %}
```

그리고 `404.html`이나 대부분의 `html` 파일에 `linkpreview.html` 삽입 안 되게 설정해야 한다.

```yaml
#_config.yml
defaults:
  - scope:
      path: "" # 모든 페이지에 대해서 적용
    values :
      livepreview : false
```

`config.yml`에 위와 같이 설정되어 있다면, 이제 `_post` 글 쓸 때마다 `metadata` 내용에 `linkpreview : true` 추가하면 된다.
{% endraw %}

> `[이렇게 텍스트]()` 만 적어놓고 링크 넣는칸을 비워두면 `a tag is missing a reference` 에러가 발생하니 비워두지 않도록 주의하자.
{: .prompt-warning }


---

이제 다음 시간에는 search 결과나 tag, category 접속 시 home 화면과 똑같은 화면으로 바꿔보도록 해보자..

# Reference
### 4-1. relative link
1. [Jekyll 커스터마이징 - Plugin(Converter)](https://namhoon.kim/2017/03/27/jekyll/024/index.html)
2. [Ruby 정규표현식](https://hanjuren.github.io/2022/01/30/ruby/Ruby-%EC%A0%95%EA%B7%9C%ED%91%9C%ED%98%84%EC%8B%9D/)
3. [Ruby sub, gsub 설명](https://jsikim1.tistory.com/291)

### 4-2. linkpreview
1. **[Linkpreview plugin github 주소](https://github.com/ysk24ok/jekyll-linkpreview)**
2. [a태그 안에 div 안 들어갈 경우..](https://velog.io/@jongk91/%EA%B0%84%EB%8B%A8-a%ED%83%9C%EA%B7%B8-%EC%A0%84%EC%B2%B4%EC%A0%81%EC%9A%A9)
3. [`a` tag is missing a reference](https://talk.jekyllrb.com/t/chirpy-theme-a-tag-is-missing-a-reference/8731/2)